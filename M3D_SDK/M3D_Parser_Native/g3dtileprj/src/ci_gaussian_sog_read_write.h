#pragma once
#include "g3dtilegaussian.h"

//================================================================================
/// SOG项结构体
/// 存储SOG格式中各个数据项的元信息
//================================================================================
struct SogItem
{
	int count;                      // 数据项数量
	int bands;                      // 波段数
	vector<int> Shape;              // 数据形状
	string Dtype;                   // 数据类型
	/** v2 */
	vector<float> Mins;             // 最小值数组（v2版本）
	/** v2 */
	vector<float> Maxs;             // 最大值数组（v2版本）
	/** v2 */
	vector<string> Files;           // 文件路径数组（v2版本）
	vector<float> Codebook;         // 码本数据
	int Quantization;               // 量化参数
	string Encoding;                // 编码方式
};

//================================================================================
/// SOG元数据结构体
/// 定义整个JSON文件的结构，包含SOG格式的所有元信息
//================================================================================
struct SogMeta {
	/** v2 */
	int Version;                    // 版本号（v2版本）
	/** v2 */
	int Count;                      // 数据总数（v2版本）

	bool Antialias;                 // 抗锯齿标志

	SogItem Means;                  // 均值数据项
	SogItem Scales;                 // 缩放数据项
	SogItem Quats;                  // 四元数数据项
	SogItem Sh0;                    // 球谐函数0阶数据项
	SogItem ShN;                    // 球谐函数高阶数据项
};

//================================================================================
/// SOG格式高斯数据读写类
/// 继承自CGGaussianReadWrite，实现对SOG格式高斯数据的读写操作
//================================================================================
class Ci_SogGaussianReadWrite : public MapGIS::Tile::CGGaussianReadWrite
{
public:
	//================================================================================
	/// 默认构造函数
	//================================================================================
	Ci_SogGaussianReadWrite()
	{
	};

	//================================================================================
	/// 虚析构函数
	//================================================================================
	virtual ~Ci_SogGaussianReadWrite() {};

protected:
	//================================================================================
	/// 内部读取接口实现
	/// 从指定SOG文件路径读取高斯数据到数据模型
	///
	/// @param [in]  filePath 文件路径
	/// @param [out] data     高斯数据模型引用
	/// @return 操作结果
	///         - gisLONG > 0：读取成功
	///         - gisLONG <= 0：读取失败
	//================================================================================
	virtual gisLONG i_Read(CGString filePath, MapGIS::Tile::GaussianModel& data);

	//================================================================================
	/// 内部回调读取接口实现
	/// 从指定SOG文件路径读取高斯数据，通过回调函数逐个处理特征点
	///
	/// @param [in] filePath  文件路径
	/// @param [in] callback  回调函数，用于处理每个高斯特征点
	/// @return 操作结果
	///         - gisLONG > 0：读取成功
	///         - gisLONG <= 0：读取失败
	//================================================================================
	virtual gisLONG i_Read(CGString filePath, std::function<void(MapGIS::Tile::GaussianFeature& dot, bool& isStop)>& callback);

	//================================================================================
	/// 内部写入接口实现
	/// 将高斯数据模型写入到指定SOG文件路径
	///
	/// @param [in] filePath 文件路径
	/// @param [in] data     高斯数据模型常量引用
	/// @return 操作结果
	///         - gisLONG > 0：写入成功
	///         - gisLONG <= 0：写入失败
	//================================================================================
	virtual gisLONG i_Write(CGString filePath, const MapGIS::Tile::GaussianModel& data);
};