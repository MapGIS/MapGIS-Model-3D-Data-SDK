#pragma once
#ifndef _G3D_TILE_RECORD_H_
#define _G3D_TILE_RECORD_H_

#include "g3dtiledefine.h"
#include <vector>

namespace MapGIS
{
	namespace Tile
	{
		//================================================================================
		/// 属性字段类型枚举
		/// 定义了支持的各种属性数据类型
		//================================================================================
		enum class FieldType : int {
			BoolType = 0,		// 布尔类型
			Int8Type = 1,		// 有符号字符类型
			Uint8Type = 2,		// 无符号字符类型
			Int16Type = 3,		// 有符号短整型
			Uint16Type = 4,	// 无符号短整型
			Int32Type = 5,		// 有符号整型
			Uint32Type = 6,	// 无符号整型
			Int64Type = 7,		// 有符号长整型
			Uint64Type = 8,	// 无符号长整型
			FloatType = 9,		// 单精度浮点型
			DoubleType = 10,	// 双精度浮点型
			TextType = 11,		// 文本类型
			DateTimeType = 12,	// 日期时间类型
			Undefined = 100		// 未定义类型
		};

		//================================================================================
		/// 属性压缩类型枚举
		/// 定义了att文件属性数据的压缩格式
		//================================================================================
		enum class AttributeCompressType : int
		{
			PropCompressTypeNone = 0,	// 无压缩
			PropCompressTypeGZip = 1,	// GZip压缩
		};

		// 前向声明
		class RecordItems;

		//================================================================================
		/// 属性值类
		/// 用于存储和操作各种类型的属性字段值
		//================================================================================
		class MAPGISG3DTILEEXPORT RecordItemValue
		{
		public:
			//================================================================================
			/// 默认构造函数
			/// 创建一个空的属性值对象
			//================================================================================
			RecordItemValue();

			//================================================================================
			/// 构造函数
			/// 创建指定类型的空属性值对象
			///
			/// @param [in] type 字段类型枚举值
			//================================================================================
			RecordItemValue(FieldType type);

			//================================================================================
			/// 构造函数
			/// 从布尔值创建属性值对象
			///
			/// @param [in] b 布尔值
			//================================================================================
			RecordItemValue(const bool& b);

			//================================================================================
			/// 构造函数
			/// 从字符值创建属性值对象
			///
			/// @param [in] c 字符值
			//================================================================================
			RecordItemValue(const char& c);

			//================================================================================
			/// 构造函数
			/// 从无符号字符值创建属性值对象
			///
			/// @param [in] c 无符号字符值
			//================================================================================
			RecordItemValue(const unsigned char& c);

			//================================================================================
			/// 构造函数
			/// 从短整型值创建属性值对象
			///
			/// @param [in] n 短整型值
			//================================================================================
			RecordItemValue(const short& n);

			//================================================================================
			/// 构造函数
			/// 从无符号短整型值创建属性值对象
			///
			/// @param [in] n 无符号短整型值
			//================================================================================
			RecordItemValue(const unsigned short& n);

			//================================================================================
			/// 构造函数
			/// 从整型值创建属性值对象
			///
			/// @param [in] n 整型值
			//================================================================================
			RecordItemValue(const int& n);

			//================================================================================
			/// 构造函数
			/// 从无符号整型值创建属性值对象
			///
			/// @param [in] n 无符号整型值
			//================================================================================
			RecordItemValue(const unsigned int& n);

			//================================================================================
			/// 构造函数
			/// 从长整型值创建属性值对象
			///
			/// @param [in] n 长整型值
			/// @param [in] isDateTime 是否为日期时间类型标志
			//================================================================================
			RecordItemValue(const gisINT64& n, bool isDateTime = false);

			//================================================================================
			/// 构造函数
			/// 从无符号长整型值创建属性值对象
			///
			/// @param [in] n 无符号长整型值
			//================================================================================
			RecordItemValue(const gisUINT64& n);

			//================================================================================
			/// 构造函数
			/// 从单精度浮点值创建属性值对象
			///
			/// @param [in] f 单精度浮点值
			//================================================================================
			RecordItemValue(const float& f);

			//================================================================================
			/// 构造函数
			/// 从双精度浮点值创建属性值对象
			///
			/// @param [in] f 双精度浮点值
			//================================================================================
			RecordItemValue(const double& f);

			//================================================================================
			/// 构造函数
			/// 从字符串值创建属性值对象
			///
			/// @param [in] s 字符串值
			//================================================================================
			RecordItemValue(const CGString& s);

			//================================================================================
			/// 拷贝构造函数
			/// 实现深拷贝操作
			///
			/// @param [in] other 源属性值对象
			//================================================================================
			RecordItemValue(const RecordItemValue& other);

			//================================================================================
			/// 移动构造函数
			/// 实现资源的高效转移
			///
			/// @param [in] other 源属性值对象（右值引用）
			//================================================================================
			RecordItemValue(RecordItemValue&& other);

			//================================================================================
			/// 析构函数
			//================================================================================
			~RecordItemValue();

			//================================================================================
			/// 拷贝赋值运算符
			/// 实现深拷贝操作
			///
			/// @param [in] other 源属性值对象
			/// @return 当前对象引用
			//================================================================================
			RecordItemValue& operator=(const RecordItemValue& other);

			//================================================================================
			/// 移动赋值运算符
			/// 实现资源的高效转移
			///
			/// @param [in] other 源属性值对象（右值引用）
			/// @return 当前对象引用
			//================================================================================
			RecordItemValue& operator=(RecordItemValue&& other);

			//================================================================================
			/// 设置为空值
			/// 将当前属性值标记为空值状态
			//================================================================================
			void SetNull();

			//================================================================================
			/// 获取字段类型
			///
			/// @return 当前属性值的字段类型枚举值
			//================================================================================
			FieldType GetFieldType() const;

			//================================================================================
			/// 判断是否为空值
			///
			/// @return 是否为空值的判断结果
			//================================================================================
			bool IsNull() const;

			//================================================================================
			/// 判断是否为布尔类型
			///
			/// @return 是否为布尔类型的判断结果
			//================================================================================
			bool IsBool() const;

			//================================================================================
			/// 判断是否为有符号字符类型
			///
			/// @return 是否为有符号字符类型的判断结果
			//================================================================================
			bool IsInt8() const;

			//================================================================================
			/// 判断是否为无符号字符类型
			///
			/// @return 是否为无符号字符类型的判断结果
			//================================================================================
			bool IsUint8() const;

			//================================================================================
			/// 判断是否为有符号短整型类型
			///
			/// @return 是否为有符号短整型类型的判断结果
			//================================================================================
			bool IsInt16() const;

			//================================================================================
			/// 判断是否为无符号短整型类型
			///
			/// @return 是否为无符号短整型类型的判断结果
			//================================================================================
			bool IsUint16() const;

			//================================================================================
			/// 判断是否为有符号整型类型
			///
			/// @return 是否为有符号整型类型的判断结果
			//================================================================================
			bool IsInt32() const;

			//================================================================================
			/// 判断是否为无符号整型类型
			///
			/// @return 是否为无符号整型类型的判断结果
			//================================================================================
			bool IsUint32() const;

			//================================================================================
			/// 判断是否为有符号长整型类型
			///
			/// @return 是否为有符号长整型类型的判断结果
			//================================================================================
			bool IsInt64() const;

			//================================================================================
			/// 判断是否为无符号长整型类型
			///
			/// @return 是否为无符号长整型类型的判断结果
			//================================================================================
			bool IsUint64() const;

			//================================================================================
			/// 判断是否为单精度浮点类型
			///
			/// @return 是否为单精度浮点类型的判断结果
			//================================================================================
			bool IsFloat() const;

			//================================================================================
			/// 判断是否为双精度浮点类型
			///
			/// @return 是否为双精度浮点类型的判断结果
			//================================================================================
			bool IsDouble() const;

			//================================================================================
			/// 判断是否为数字类型
			/// 包括所有整型和浮点型
			///
			/// @return 是否为数字类型的判断结果
			//================================================================================
			bool IsNumber() const;

			//================================================================================
			/// 判断是否为文本类型
			///
			/// @return 是否为文本类型的判断结果
			//================================================================================
			bool IsText() const;

			//================================================================================
			/// 判断是否为日期时间类型
			///
			/// @return 是否为日期时间类型的判断结果
			//================================================================================
			bool IsDateTime() const;

			//================================================================================
			/// 转换为布尔类型
			///
			/// @return 转换后的布尔值
			//================================================================================
			bool ToBool() const;

			//================================================================================
			/// 转换为有符号字符类型
			///
			/// @return 转换后的有符号字符值
			//================================================================================
			char ToInt8() const;

			//================================================================================
			/// 转换为无符号字符类型
			///
			/// @return 转换后的无符号字符值
			//================================================================================
			unsigned char ToUint8() const;

			//================================================================================
			/// 转换为有符号短整型类型
			///
			/// @return 转换后的有符号短整型值
			//================================================================================
			short ToInt16() const;

			//================================================================================
			/// 转换为无符号短整型类型
			///
			/// @return 转换后的无符号短整型值
			//================================================================================
			unsigned short ToUint16() const;

			//================================================================================
			/// 转换为有符号整型类型
			///
			/// @return 转换后的有符号整型值
			//================================================================================
			int ToInt32() const;

			//================================================================================
			/// 转换为无符号整型类型
			///
			/// @return 转换后的无符号整型值
			//================================================================================
			unsigned int ToUint32() const;

			//================================================================================
			/// 转换为有符号长整型类型
			///
			/// @return 转换后的有符号长整型值
			//================================================================================
			gisINT64 ToInt64() const;

			//================================================================================
			/// 转换为无符号长整型类型
			///
			/// @return 转换后的无符号长整型值
			//================================================================================
			gisUINT64 ToUint64() const;

			//================================================================================
			/// 转换为单精度浮点类型
			///
			/// @return 转换后的单精度浮点值
			//================================================================================
			float ToFloat() const;

			//================================================================================
			/// 转换为双精度浮点类型
			///
			/// @return 转换后的双精度浮点值
			//================================================================================
			double ToDouble() const;

			//================================================================================
			/// 转换为文本类型
			///
			/// @return 转换后的文本字符串
			//================================================================================
			CGString ToText() const;

			//================================================================================
			/// 转换为文本类型
			///
			/// @return 转换后的文本字符串
			//================================================================================
			CGString ToString() const;

			//================================================================================
			/// 转换为文本类型
			///
			/// @param [in] encodeType 编码类型
			/// @return 转换后的文本字符串
			//================================================================================
			CGString ToString(CGString::EncodeType encodeType) const;

			//================================================================================
			/// 转换为日期时间类型
			///
			/// @return 转换后的日期时间值（时间戳）
			//================================================================================
			gisINT64 ToDateTime() const;

			//================================================================================
			/// 等于比较运算符
			///
			/// @param [in] other 待比较的对象
			/// @return 比较结果
			//================================================================================
			bool operator==(const RecordItemValue& other) const;

			//================================================================================
			/// 不等于比较运算符
			///
			/// @param [in] other 待比较的对象
			/// @return 比较结果
			//================================================================================
			bool operator!=(const RecordItemValue& other) const;

			// 声明友元类，允许RecordItems访问私有成员
			friend class RecordItems;

		private:
			FieldType m_type;				// 属性字段类型
			std::vector<char> m_fieldValue;	// 属性字段值存储（以字节形式）
			bool m_isNull;					// 是否为空值标志
		};

		//================================================================================
		/// 字段信息类
		/// 存储属性字段的元数据信息
		//================================================================================
		class MAPGISG3DTILEEXPORT Field
		{
		public:
			unsigned int fieldID;						// 字段ID
			CGString name;								// 字段名称
			CGString alias;								// 字段别名
			FieldType type;								// 字段类型
			MapGIS::Tile::RecordItemValue noDataValue;	// 字段无效值
			MapGIS::Tile::RecordItemValue minValue;		// 字段最小值
			MapGIS::Tile::RecordItemValue maxValue;		// 字段最大值

			//================================================================================
			/// 默认构造函数
			//================================================================================
			Field();

			//================================================================================
			/// 拷贝构造函数
			///
			/// @param [in] field 源字段对象
			//================================================================================
			Field(const Field& field);

			//================================================================================
			/// 移动构造函数
			///
			/// @param [in] field 源字段对象（右值引用）
			//================================================================================
			Field(Field&& field);

			//================================================================================
			/// 拷贝赋值运算符
			///
			/// @param [in] field 源字段对象
			/// @return 当前对象引用
			//================================================================================
			Field& operator=(const Field& field);

			//================================================================================
			/// 移动赋值运算符
			///
			/// @param [in] field 源字段对象（右值引用）
			/// @return 当前对象引用
			//================================================================================
			Field& operator=(Field&& field);

			//================================================================================
			/// 等于比较运算符
			///
			/// @param [in] field 待比较的字段对象
			/// @return 比较结果
			//================================================================================
			bool operator==(const Field& field) const;

			//================================================================================
			/// 不等于比较运算符
			///
			/// @param [in] field 待比较的字段对象
			/// @return 比较结果
			//================================================================================
			bool operator!=(const Field& field) const;
		};

		//================================================================================
		/// 图层字段信息类
		/// 存储图层的属性结构信息
		//================================================================================
		class MAPGISG3DTILEEXPORT LayerFieldsInfo
		{
		public:
			unsigned int layerID;			// 图层ID
			CGString dataSource;			// 图层数据源路径
			CGString layerName;				// 图层名称
			std::vector<Field> fieldInfos;	// 字段信息集合

			//================================================================================
			/// 默认构造函数
			//================================================================================
			LayerFieldsInfo();

			//================================================================================
			/// 拷贝构造函数
			///
			/// @param [in] layerInfo 源图层字段信息对象
			//================================================================================
			LayerFieldsInfo(const LayerFieldsInfo& layerInfo);

			//================================================================================
			/// 移动构造函数
			///
			/// @param [in] layerInfo 源图层字段信息对象（右值引用）
			//================================================================================
			LayerFieldsInfo(LayerFieldsInfo&& layerInfo);

			//================================================================================
			/// 拷贝赋值运算符
			///
			/// @param [in] layerInfo 源图层字段信息对象
			/// @return 当前对象引用
			//================================================================================
			LayerFieldsInfo& operator=(const LayerFieldsInfo& layerInfo);

			//================================================================================
			/// 移动赋值运算符
			///
			/// @param [in] layerInfo 源图层字段信息对象（右值引用）
			/// @return 当前对象引用
			//================================================================================
			LayerFieldsInfo& operator=(LayerFieldsInfo&& layerInfo);

			//================================================================================
			/// 等于比较运算符
			///
			/// @param [in] layerInfo 待比较的图层字段信息对象
			/// @return 比较结果
			//================================================================================
			bool operator==(const LayerFieldsInfo& layerInfo) const;

			//================================================================================
			/// 不等于比较运算符
			///
			/// @param [in] layerInfo 待比较的图层字段信息对象
			/// @return 比较结果
			//================================================================================
			bool operator!=(const LayerFieldsInfo& layerInfo) const;
		};

		//================================================================================
		/// 属性记录类
		/// 存储一条属性记录的所有字段值
		//================================================================================
		class MAPGISG3DTILEEXPORT Record
		{
		public:
			//================================================================================
			/// 默认构造函数
			//================================================================================
			Record();

			//================================================================================
			/// 析构函数
			//================================================================================
			~Record();

			//================================================================================
			/// 拷贝构造函数
			///
			/// @param [in] other 源记录对象
			//================================================================================
			Record(const Record& other);

			//================================================================================
			/// 移动构造函数
			///
			/// @param [in] other 源记录对象（右值引用）
			//================================================================================
			Record(Record&& other);

			//================================================================================
			/// 获取记录ID
			///
			/// @return 记录ID值
			//================================================================================
			gisINT64 GetID() const;

			//================================================================================
			/// 设置记录ID
			///
			/// @param [in] id 要设置的记录ID值
			//================================================================================
			void SetID(gisINT64 id);

			//================================================================================
			/// 添加一个空值属性项
			//================================================================================
			void AppendItem();

			//================================================================================
			/// 添加指定类型的空值属性项
			///
			/// @param [in] type 属性字段类型
			//================================================================================
			void AppendItem(FieldType type);

			//================================================================================
			/// 添加布尔类型属性项
			///
			/// @param [in] b 布尔值
			//================================================================================
			void AppendItem(const bool& b);

			//================================================================================
			/// 添加字符类型属性项
			///
			/// @param [in] c 字符值
			//================================================================================
			void AppendItem(const char& c);

			//================================================================================
			/// 添加无符号字符类型属性项
			///
			/// @param [in] c 无符号字符值
			//================================================================================
			void AppendItem(const unsigned char& c);

			//================================================================================
			/// 添加短整型属性项
			///
			/// @param [in] n 短整型值
			//================================================================================
			void AppendItem(const short& n);

			//================================================================================
			/// 添加无符号短整型属性项
			///
			/// @param [in] n 无符号短整型值
			//================================================================================
			void AppendItem(const unsigned short& n);

			//================================================================================
			/// 添加整型属性项
			///
			/// @param [in] n 整型值
			//================================================================================
			void AppendItem(const int& n);

			//================================================================================
			/// 添加无符号整型属性项
			///
			/// @param [in] n 无符号整型值
			//================================================================================
			void AppendItem(const unsigned int& n);

			//================================================================================
			/// 添加长整型属性项
			///
			/// @param [in] n 长整型值
			/// @param [in] isDateTime 是否为日期时间类型标志
			//================================================================================
			void AppendItem(const gisINT64& n, bool isDateTime = false);

			//================================================================================
			/// 添加无符号长整型属性项
			///
			/// @param [in] n 无符号长整型值
			//================================================================================
			void AppendItem(const gisUINT64& n);

			//================================================================================
			/// 添加单精度浮点型属性项
			///
			/// @param [in] f 单精度浮点值
			//================================================================================
			void AppendItem(const float& f);

			//================================================================================
			/// 添加双精度浮点型属性项
			///
			/// @param [in] f 双精度浮点值
			//================================================================================
			void AppendItem(const double& f);

			//================================================================================
			/// 添加字符串类型属性项
			///
			/// @param [in] s 字符串值
			//================================================================================
			void AppendItem(const CGString& s);

			//================================================================================
			/// 添加属性项
			///
			/// @param [in] item 属性值对象
			//================================================================================
			void AppendItem(const RecordItemValue& item);

			//================================================================================
			/// 获取属性项个数
			///
			/// @return 属性项个数
			//================================================================================
			gisLONG GetNum() const;

			//================================================================================
			/// 获取指定索引的属性值
			///
			/// @param [in] index 属性项索引
			/// @param [out] value 用于接收属性值的引用
			/// @return 操作结果
			///         - gisLONG > 0：获取成功
			///         - gisLONG <= 0：获取失败
			//================================================================================
			gisLONG GetItem(int index, RecordItemValue& value) const;

			//================================================================================
			/// 拷贝赋值运算符
			///
			/// @param [in] other 源记录对象
			/// @return 当前对象引用
			//================================================================================
			Record& operator=(const Record& other);

			//================================================================================
			/// 移动赋值运算符
			///
			/// @param [in] other 源记录对象（右值引用）
			/// @return 当前对象引用
			//================================================================================
			Record& operator=(Record&& other);

		private:
			gisINT64 id;				// 属性记录ID
			RecordItems* pRecordItems;	// 属性记录项管理对象指针
		};

		//================================================================================
		/// 图层属性类
		/// 存储一个图层的所有属性信息
		//================================================================================
		class MAPGISG3DTILEEXPORT LayerAttribute
		{
		public:
			LayerFieldsInfo layerInfo;		// 图层结构信息
			std::vector<Record> records;	// 属性记录集合
		};

		//================================================================================
		/// 属性信息类
		/// 存储所有图层的属性信息
		//================================================================================
		class MAPGISG3DTILEEXPORT Attribute
		{
		public:
			std::vector<LayerAttribute> layers;	// 属性图层信息集合
		};
	}
}
#endif